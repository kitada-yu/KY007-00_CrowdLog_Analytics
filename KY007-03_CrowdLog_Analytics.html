<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>📊CrowdLog Analytics</title>
    <link rel="stylesheet" href="KY007-03_CrowdLog_Analytics.css" />

  </head>

  <body>
    <div class="container">
      <!-- Header & Drop Zone -->
      <div class="header-row">
        <div class="header-content">
          <div class="app-logo"></div>
        </div>

        <div class="file-timestamp-box">
          <div id="fileTimestamp" class="file-timestamp"></div>
        </div>

        <div style="display: flex; gap: 15px; align-items: stretch">
          <!-- 追加: ファイル選択ボタン / 非表示 input / ドロップゾーン / ファイル情報 -->
          <div id="fileControls" style="display:flex;gap:8px;align-items:center;">
            <input id="fileInput" type="file" accept=".csv" style="display:none" />
            <button id="btnSelectFile" type="button">CSVを選択</button>
            <div id="fileInfo" class="file-info hidden" aria-live="polite"></div>
          </div>

          <div id="dropZone" class="drop-zone" style="min-width:220px;padding:10px;border:1px dashed #ccc;border-radius:6px;">
            <div style="text-align:center;font-size:13px;color:#666">ここにCSVをドロップ</div>
          </div>
        </div>
      </div>

      <!-- Control Panel REMOVED -->

      <!-- Filter Section -->
      <div class="filter-section hidden" id="filterSection">
        <div class="filter-group" id="mainControls">
          <!-- Period Selector -->
          <div
            style="
              margin-bottom: 24px;
              border-bottom: 1px solid var(--border-color);
              padding-bottom: 16px;
            "
          >
            <div class="filter-title">📅 集計期間</div>
            <div
              class="period-selector"
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 0.85rem;
              "
            >
              <select
                id="periodStart"
                onchange="updatePeriodFilter()"
                class="filter-search"
                style="
                  margin-bottom: 0;
                  padding: 4px 8px;
                  width: 100px;
                  font-size: 0.85rem;
                "
              >
              </select>
              </select>
              <span style="color: var(--text-sub)">〜</span>
              <select
                id="periodEnd"
                onchange="updatePeriodFilter()"
                class="filter-search"
                style="
                  margin-bottom: 0;
                  padding: 4px 8px;
                  width: 100px;
                  font-size: 0.85rem;
                "
              >
              </select>
              </select>
              <button
                class="btn-small btn-outline"
                onclick="resetPeriod()"
                style="padding: 4px 8px"
                title="全期間にリセット"
              >
                ↺
              </button>
            </div>
          </div>

          <div class="filter-title">📈 分析タイプ</div>
          <div
            class="radio-group vertical-radio-group"
            id="analysisType"
            role="radiogroup"
          >
            <label class="radio-item active">
              <input type="radio" name="analysisType" value="overall" checked />
              全体
            </label>
            <label class="radio-item">
              <input type="radio" name="analysisType" value="project" />
              プロジェクト別
            </label>
            <label class="radio-item">
              <input type="radio" name="analysisType" value="department" />
              部署別
            </label>
            <label class="radio-item">
              <input type="radio" name="analysisType" value="employee" />
              従業員別
            </label>
            <label class="radio-item">
              <input type="radio" name="analysisType" value="monthly" />
              月別推移
            </label>
          </div>
        </div>

        <div class="filter-group" id="projectFilters">
          <div class="filter-title">📁 プロジェクト</div>
          <input
            type="text"
            class="filter-search"
            id="projectSearch"
            placeholder="🔍 検索..."
          />
          <div class="filter-actions">
            <button class="btn-small" onclick="selectAll('projects')">
              全選択
            </button>
            <button
              class="btn-small btn-outline"
              onclick="deselectAll('projects')"
            >
              全解除
            </button>
            <select
              class="filter-sort-select"
              onchange="updateFilterSort('projects', this.value)"
            >
              <option value="name_asc">昇順</option>
              <option value="name_desc">降順</option>
              <option value="selected">選択順</option>
            </select>
          </div>
          <div class="filter-items" id="projectFilterItems"></div>
        </div>
        <div class="filter-group" id="departmentFilters">
          <div class="filter-title">🏢 部署</div>
          <input
            type="text"
            class="filter-search"
            id="departmentSearch"
            placeholder="🔍 検索..."
          />
          <div class="filter-actions">
            <button class="btn-small" onclick="selectAll('departments')">
              全選択
            </button>
            <button
              class="btn-small btn-outline"
              onclick="deselectAll('departments')"
            >
              全解除
            </button>
            <select
              class="filter-sort-select"
              onchange="updateFilterSort('departments', this.value)"
            >
              <option value="name_asc">昇順</option>
              <option value="name_desc">降順</option>
              <option value="selected">選択順</option>
            </select>
          </div>
          <div class="filter-items" id="departmentFilterItems"></div>
        </div>
        <div class="filter-group" id="employeeFilters">
          <div class="filter-title">👤 従業員</div>
          <input
            type="text"
            class="filter-search"
            id="employeeSearch"
            placeholder="🔍 検索..."
          />
          <div class="filter-actions">
            <button class="btn-small" onclick="selectAll('employees')">
              全選択
            </button>
            <button
              class="btn-small btn-outline"
              onclick="deselectAll('employees')"
            >
              全解除
            </button>
            <select
              class="filter-sort-select"
              onchange="updateFilterSort('employees', this.value)"
            >
              <option value="name_asc">昇順</option>
              <option value="name_desc">降順</option>
              <option value="selected">選択順</option>
            </select>
          </div>
          <div class="filter-items" id="employeeFilterItems"></div>
        </div>
      </div>

      <!-- Favorites Section -->
      <div class="favorites-section hidden" id="favoritesSection">
        <div
          style="
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
          "
        >
          <div style="display: flex; align-items: center; gap: 10px">
            <div style="font-weight: 600; color: var(--accent-purple)">
              ★ お気に入り
            </div>
          </div>

          <div style="display: flex; align-items: center; gap: 10px; flex: 1">
            <select
              id="savedFiltersSelect"
              class="filter-search"
              style="margin-bottom: 0; width: auto; flex: 1"
              onchange="applySavedFilter(this.value)"
            >
              <option value="">(条件を選択)</option>
            </select>
            <button
              class="btn-icon-tiny"
              id="btnSaveFilter"
              onclick="saveCurrentFilter()"
              title="現在の条件を新規保存"
              style="font-size: 1.5rem"
            >
              ➕
            </button>
          </div>

          <div style="display: flex; gap: 8px">
            <button
              class="btn-icon"
              id="btnOverwriteFilter"
              onclick="overwriteCurrentFilter()"
              title="上書き保存"
              disabled
            >
              💾
            </button>
            <button
              class="btn-icon"
              id="btnCopyFilter"
              onclick="copyCurrentFilter()"
              title="複製して保存"
              disabled
            >
              📑
            </button>
            <button
              class="btn-icon"
              id="btnRenameFilter"
              onclick="renameCurrentFilter()"
              title="名前を変更"
              disabled
            >
              ✏️
            </button>
            <button
              class="btn-icon danger"
              id="btnDeleteFilter"
              onclick="deleteCurrentFilter()"
              title="削除"
              disabled
            >
              🗑️
            </button>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
       <!--
      <div class="summary-cards hidden" id="summaryCards">
        <div class="summary-card">
          <div class="summary-card-value planned" id="totalPlanned">0</div>
          <div class="summary-card-label">予定時間（合計）</div>
        </div>
        <div class="summary-card">
          <div class="summary-card-value actual" id="totalActual">0</div>
          <div class="summary-card-label">実績時間（合計）</div>
        </div>
        <div class="summary-card">
          <div class="summary-card-value" id="totalDiff">0</div>
          <div class="summary-card-label">差異（実績 - 予定）</div>
        </div>
        <div class="summary-card">
          <div class="summary-card-value" id="totalRate">0%</div>
          <div class="summary-card-label">到達率</div>
        </div>
      </div>
    -->

      <!-- Chart Section -->
      <div class="chart-section hidden" id="chartSection">
        <div class="chart-container">
          <!-- 追加: 描画用キャンバス -->
          <canvas id="chart" width="800" height="350" style="width:100%;height:350px;"></canvas>
        </div>
        <div class="chart-footer"></div>

        <!-- Data Table -->
        <div class="table-container" id="dataTableContainer"></div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" aria-live="polite" role="status"></div>

    <script src="KY007-03_CrowdLog_Analytics.js"></script>

  </body>
</html>
